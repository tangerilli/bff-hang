#!/bin/bash
set -euo pipefail

if ! command -v go >/dev/null 2>&1; then
  echo "Go is required for the pre-commit hook." >&2
  exit 1
fi

go_files=$(git ls-files '*.go')
if [ -n "$go_files" ]; then
  unformatted=$(gofmt -l $go_files)
  if [ -n "$unformatted" ]; then
    echo "Go files must be formatted with gofmt:" >&2
    echo "$unformatted" >&2
    exit 1
  fi

  go vet ./...
fi

go test ./...
